---
title: "plots"
author: "Greta Lotz"
date: "2024-04-17"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
First: run Thesis.rmd 
Second: run SCM_oecd
filepath starts with "plots/
theme_classic macht den start nicht im Nullpunkt wo sich die Achsen treffen, sondern leicht versetzt. Daher: expand = expansion(mult = c(0, 0)
Titles only in word, no x-axis label

```{r}

```


```{r Weights table}
library(dplyr)
library(flextable)
library(officer)

# weights_df is original data frame
# Rename columns and drop 'unit.numbers'
weights_df <- weights_df %>%
  select(
    Country = unit.names,  # Rename unit.names to Country
    Weight = w.weights     # Rename w.weights to Weight
  ) %>%
  mutate(Weight = round(Weight, 3))  # round the weights to three decimal places


# Round the weights to three decimal places
weights_df$Weight <- round(weights_df$Weight, 3)

# Split the data frame into two halves for two columns
half <- ceiling(nrow(weights_df) / 2)
first_half <- weights_df[1:half, ]
second_half <- weights_df[(half + 1):nrow(weights_df), ]

# Combine the two halves
combined_weights <- cbind(first_half, second_half)
combined_weights <- setNames(combined_weights, c("Country1", "Weight1", "Country2", "Weight2"))


# Create a flextable
ft <- flextable(combined_weights)
ft <- set_header_df(ft, mapping = data.frame(values = c("Country", "Weight", "Country", "Weight"), col_keys = names(combined_weights)))
ft <- theme_booktabs(ft)  # Adds nice lines; modify if you prefer no lines
ft <- fontsize(ft, size = 12, part = "all")
ft <- font(ft, fontname = "Times New Roman", part = "all")

# Create a Word document and add the flextable
doc <- read_docx()
doc <- body_add_flextable(doc, value = ft)

# Save the Word document
file_path <- "plots/Word_Document.docx" 
print(doc, target = file_path)

```



```{r regression table 1}
library(knitr)
library(kableExtra)

# Renaming the rows
rownames(table_avg_comparison) <- c(
  "GDP per capita",
  "Gasoline consumption per capita",
  "Motor vehicles (per 1,000 people)",
  "Urban population",
  "CO\u2082 from transport per capita 1990",
  "CO\u2082 from transport per capita 1980",
  "CO₂ from transport per capita 1970"
)

# Convert matrix to a data frame for easier manipulation
table_avg_comparison_df <- as.data.frame(table_avg_comparison)

# Round numeric data to 1 decimal
table_avg_comparison_df <- round(table_avg_comparison_df, 1)

# Renaming columns correctly for the data frame
names(table_avg_comparison_df) <- c("Norway", "Synth. Norway", "OECD sample")

# Add new column at the beginning for the row names from the matrix
table_avg_comparison_df <- cbind("Variables" = rownames(table_avg_comparison), table_avg_comparison_df)

# Update rownames to NULL to avoid duplication in kable output
rownames(table_avg_comparison_df) <- NULL

# Generate table with knitr::kable
kable_output <- kable(table_avg_comparison_df, format = "html", escape = FALSE) %>%
  kable_styling(full_width = FALSE, bootstrap_options = "striped", position = "center")

print(kable_output)
```

```{r regression table 2}
library(flextable)
library(officer)

# Create flextable from data frame
flex_table <- flextable(table_avg_comparison_df)

# Set the font size and family for table
flex_table <- flex_table %>%
  font(fontname = "Times New Roman", part = "all") %>%
  fontsize(size = 12, part = "all")

print(flex_table)

# Create new Word document and add flextable
doc <- read_docx()
doc <- body_add_flextable(doc, value = flex_table)

# Save document
file_path <- "plots/Word_Document_2.docx"
print(doc, target = file_path)
```

Fertig, als Beispiel
```{r diff in diff plot}
DiD_plot <- ggplot(comparison_data, aes(x = year)) +
  geom_line(aes(y = CO2_transport_capita, color = "Norway", linetype = "Norway"), size = 0.5) +  # Solid line for Norway (Actual data)
  geom_line(aes(y = average_CO2_transport_capita, color = "OECD sample", linetype = "OECD sample"), size = 0.5) +  # Dashed line for OECD sample
  geom_vline(xintercept = 1991, linetype = "dotted", color = "black", size = 0.5) +  # Dotted line at the year 1991
  labs(title = NULL,
       x = NULL,
       y = "Metric tons per capita (CO\u2082 from transport)",
       color = "Legend",
       linetype = "Legend") +  # Label for linetype legend
  theme_classic() +
  theme(legend.position = c(.85, .13),
        legend.title = element_blank(),  # Remove the legend title for simplicity
        legend.text = element_text(size = 8),  # Set text size for legend
        legend.background = element_rect(fill = "white", color = "black"),  # White background for legend
        legend.key = element_blank()) +  # No boxes around the legend symbols
  annotate("text", x = 1985, y = 1, label = "Carbon tax", hjust = 0, color = "black") +
  scale_y_continuous(limits = c(0, 3.5), breaks = seq(0, 3.5, by = 0.5), expand = expansion(mult = c(0, 0))) +
  scale_x_continuous(limits = c(1960, 2005), breaks = seq(1960, 2005, by = 10), expand = expansion(mult = c(0, 0))) +
  scale_color_manual(values = c("Norway" = "black", "OECD sample" = "black")) +  # Define colors
  scale_linetype_manual(values = c("Norway" = "solid", "OECD sample" = "dashed"))  # Define line types


print(DiD_plot)

# Save plot
ggsave("plots/DiD_plot.jpg", plot = DiD_plot, width = 7, height = 6, units = "in", dpi = 500)

```


Auch fertig
```{r alternative path.plot}

path_plot <- ggplot(path_data, aes(x = Year)) +
  geom_line(aes(y = X10, color = "Norway", linetype = "Norway"), size = 0.5) +  # Solid line for Norway (Actual data)
  geom_line(aes(y = Synthetic, color = "Synthetic Norway", linetype = "Synthetic Norway"), size = 0.5) +  # Dashed line for Synthetic control
  geom_vline(xintercept = 1991, linetype = "dotted", color = "black", size = 0.5) +  # Dotted line at the year 1990
  labs(title = NULL,
       x = NULL,
       y = "Metric tons per capita (CO\u2082 from transport)",
       color = "Legend",
       linetype = "Legend") +  # Label for linetype legend
  theme_classic() +
  theme(legend.position = c(.85, .13),
        legend.title = element_blank(),  # Remove the legend title for simplicity
        legend.text = element_text(size = 8),  # Set text size for legend
        legend.background = element_rect(fill = "white", colour = "black"), 
        #panel.grid.major = element_blank(),  # Remove major grid lines
        #panel.grid.minor = element_blank(),
        legend.key = element_blank()) +  # No boxes around the legend symbols
  annotate("text", x = 1985, y = 1, label = "Carbon tax", hjust = 0, color = "black") +
  scale_y_continuous(limits = c(0, 3.5), breaks = seq(0, 3.5, by = 0.5), expand = expansion(mult = c(0, 0))) +
  scale_x_continuous(limits = c(1960, 2005), breaks = seq(0, 2005, by = 10) , expand = expansion(mult = c(0, 0))) +
  scale_color_manual(values = c("Norway" = "black", "Synthetic Norway" = "black")) +  # Set line colors
  scale_linetype_manual(values = c("Norway" = "solid", "Synthetic Norway" = "dashed"))  # Set line types

print(path_plot)

# Save plot
ggsave("plots/path_plot.jpg", plot = path_plot, width = 7, height = 6, units = "in", dpi = 500)

```


### gap plot
Andersson p.14
```{r wv}
gap_plot <- ggplot(gap_data, aes(x = Year, y = Gap)) +
  geom_line(color = "black") +  # Line for the Gap
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +  # Zero line
  labs(title = NULL,
       x = NULL,
       y = "Gap in Metric tons per capita (CO\u2082 from transport)") +
  theme_classic() +
  theme(legend.position = "none") +
  scale_y_continuous(limits = c(-1, 1), breaks = c(-1, -.5, 0, .5, 1), expand = expansion(mult = c(0, 0))) +
  scale_x_continuous(limits = c(1960, 2005), breaks = seq(0, 2005, by = 10) , expand = expansion(mult = c(0, 0))) +
#  ylim(-0.8, 1) +
  geom_vline(xintercept = 1991, linetype = "dotted", color = "black") +
  annotate("text", x = 1990, y = -0.35, label = "Carbon tax", hjust = 1)

print(gap_plot)

ggsave("plots/gap_plot.jpg", plot = gap_plot, width = 7, height = 6, units = "in", dpi = 500)

```


### fuel prices
Andersson p.7
Run fuel_prices.Rmd

```{r wv_1 disaggregation fuel price, message=FALSE, warning=FALSE}
library(cowplot)

fuel_prices_diesel <- fuel_prices_combined %>%
  filter(fuel_type == "Panel A: Diesel")

fuel_prices_gasoline <- fuel_prices_combined %>%
  filter(fuel_type == "Panel B: Gasoline")

# Erster Plot
plot_disaggregation_wv_1 <- ggplot(data = fuel_prices_diesel, aes(x = year)) +
  geom_line(aes(y = road_tax, colour = "Road Tax", linetype = "Road Tax")) +
  geom_line(aes(y = co2_tax, colour = "CO\u2082 Tax", linetype = "CO\u2082 Tax")) +
  geom_line(aes(y = vat, colour = "VAT", linetype = "VAT")) +
  geom_line(aes(y = basic_tax_diesel, colour = "Basic Tax", linetype = "Basic Tax")) +
  geom_line(aes(y = full_price, colour = "Retail Price", linetype = "Retail Price")) +
  geom_vline(xintercept = 1991, linetype = "dotted", colour = "black") +
  facet_wrap(~"Panel A.\nDiesel", ncol = 1) +
  labs(title = NULL,
       x = NULL,  # Removes the x-axis label
       y = "Price (NOK/litre)",
       colour = NULL,
       linetype = NULL) +
  theme_classic() +
  theme(
    legend.position = "none",
    strip.text = element_text(size = 13, color = "black", hjust = 0), # Beispiele für Layout-Anpassungen
    strip.background = element_blank()
  ) +
  scale_colour_manual(values = c("Road Tax" = "black", "VAT" = "gray20", "CO\u2082 Tax" = "grey40", "Basic Tax" = "grey60", "Retail Price" = "grey80")) +
  scale_linetype_manual(values = c("Road Tax" = "solid", "VAT" = "dotdash", "CO\u2082 Tax" = "dashed","Basic Tax" = "dotted", "Retail Price" = "longdash")) +
  ylim(0, 12.5) +
  scale_y_continuous(limits = c(0, 15), breaks = seq(0, 14, by = 2), expand = expansion(mult = c(0, 0))) + # More frequent breaks on the y-axis
  scale_x_continuous(limits = c(1985, 2009), breaks = seq(1985, 2005, by = 5) , expand = expansion(mult = c(0, 0)))

# Zweiter Plot
plot_disaggregation_wv_2 <- ggplot(data = fuel_prices_gasoline, aes(x = year)) +
  geom_line(aes(y = road_tax, colour = "Road Tax", linetype = "Road Tax")) +
  geom_line(aes(y = co2_tax, colour = "CO\u2082 Tax", linetype = "CO\u2082 Tax")) +
  geom_line(aes(y = vat, colour = "VAT", linetype = "VAT")) +
  geom_line(aes(y = basic_tax_diesel, colour = "Basic Tax", linetype = "Basic Tax")) +
  geom_line(aes(y = full_price, colour = "Retail Price", linetype = "Retail Price")) +
  geom_vline(xintercept = 1991, linetype = "dotted", colour = "black") +
  facet_wrap(~"Panel B.\nGasoline", ncol = 1) +
  labs(title = NULL,
       x = NULL,  # Removes the x-axis label
       y = "Price (NOK/litre)",
       colour = NULL,
       linetype = NULL) +
  theme_classic() +
  theme(legend.position = c(.75, .5),
        legend.title = element_blank(),  # Remove the legend title for simplicity
        legend.text = element_text(size = 8),  # Set text size for legend
        legend.background = element_rect(fill = "white", colour = "black"),
        strip.text = element_text(size = 13, color = "black", hjust = 0), # Beispiele für Layout-Anpassungen
        strip.background = element_blank()
        #title = element_rect(colour = "black", fill = "blue")
        #plot.title.box = element_rect(size = 0.5, color = "black", linetype = "dashed", fill = "white")
        ) +
    scale_colour_manual(values = c("Retail Price" = "grey80", "Road Tax" = "black", "VAT" = "gray20", "CO\u2082 Tax" = "grey40", "Basic Tax" = "grey60"),
                      breaks = c("Retail Price", "Road Tax", "VAT", "CO\u2082 Tax", "Basic Tax")) +
  scale_linetype_manual(values = c("Retail Price" = "longdash", "Road Tax" = "twodash", "VAT" = "dotdash", "CO\u2082 Tax" = "dashed", "Basic Tax" = "dotted"),
                        breaks = c("Retail Price", "Road Tax", "VAT", "CO\u2082 Tax", "Basic Tax")) +
   scale_y_continuous(limits = c(0, 15), breaks = seq(0, 14, by = 2), expand = expansion(mult = c(0, 0))) + # More frequent breaks on the y-axis
  scale_x_continuous(limits = c(1985, 2009), breaks = seq(1985, 2005, by = 5) , expand = expansion(mult = c(0, 0)))

# Combine plots
combined_disaggregated_tax_plots <- cowplot::plot_grid(plot_disaggregation_wv_1, plot_disaggregation_wv_2, ncol = 2) 

# Show the combined plot
print(combined_disaggregated_tax_plots)
```

```{r wv_2 aggregation fuel price, message=FALSE, warning=FALSE}
library(cowplot)

fuel_prices_diesel <- fuel_prices_combined %>%
  filter(fuel_type == "Panel A: Diesel")

fuel_prices_gasoline <- fuel_prices_combined %>%
  filter(fuel_type == "Panel B: Gasoline")

# Erster Plot
plot_aggregation_wv_1 <- ggplot(data = fuel_prices_diesel, aes(x = year)) +
  geom_line(aes(y = total_taxes, colour = "Total Tax", linetype = "Total Tax")) +
  geom_line(aes(y = full_price, colour = "Retail Price", linetype = "Retail Price")) +
  geom_vline(xintercept = 1991, linetype = "dotted", colour = "black") +
  facet_wrap(~"Panel A.\nDiesel", ncol = 1) +
  labs(title = NULL,
       x = NULL,  # Removes the x-axis label
       y = "Price (NOK/litre)",
       colour = NULL,
       linetype = NULL) +
  theme_classic() +
  theme(
    legend.position = "none",
    strip.text = element_text(size = 13, color = "black", hjust = 0), # Beispiele für Layout-Anpassungen
    strip.background = element_blank()
  ) +
  scale_colour_manual(values = c("Total Tax" = "black", "Retail Price" = "grey80")) +
  scale_linetype_manual(values = c("Total Tax" = "solid", "Retail Price" = "longdash")) +
  ylim(0, 12.5) +
  scale_y_continuous(limits = c(0, 15), breaks = seq(0, 14, by = 2), expand = expansion(mult = c(0, 0))) + # More frequent breaks on the y-axis
  scale_x_continuous(limits = c(1985, 2009), breaks = seq(1985, 2005, by = 5) , expand = expansion(mult = c(0, 0)))


# Zweiter Plot
plot_aggregation_wv_2 <- ggplot(data = fuel_prices_gasoline, aes(x = year)) +
  geom_line(aes(y = total_taxes, colour = "Total Tax", linetype = "Total Tax")) +
  geom_line(aes(y = full_price, colour = "Retail Price", linetype = "Retail Price")) +
  geom_vline(xintercept = 1991, linetype = "dotted", colour = "black") +
  facet_wrap(~"Panel B.\nGasoline", ncol = 1) +
  labs(title = NULL,
       x = NULL,  # Removes the x-axis label
       y = "Price (NOK/litre)",
       colour = NULL,
       linetype = NULL) +
  theme_classic() +
  theme(legend.position = c(.75, .25),
        legend.title = element_blank(),  # Remove the legend title for simplicity
        legend.text = element_text(size = 8),  # Set text size for legend
        legend.background = element_rect(fill = "white", colour = "black"),
        strip.text = element_text(size = 13, color = "black", hjust = 0), # Beispiele für Layout-Anpassungen
        strip.background = element_blank()
        ) +
  scale_colour_manual(values = c("Total Tax" = "black", "Retail Price" = "grey80")) +
  scale_linetype_manual(values = c("Total Tax" = "solid", "Retail Price" = "longdash")) +
  ylim(0, 12.5) +
  scale_y_continuous(limits = c(0, 15), breaks = seq(0, 14, by = 2), expand = expansion(mult = c(0, 0))) + # More frequent breaks on the y-axis
  scale_x_continuous(limits = c(1985, 2009), breaks = seq(1985, 2005, by = 5) , expand = expansion(mult = c(0, 0))) +
  guides(fill = guide_legend(override.aes = list(size = 3)))

# Combine plots
combined_aggregated_tax_plots <- cowplot::plot_grid(plot_aggregation_wv_1, plot_aggregation_wv_2, ncol = 2) 

# Show the combined plot
print(combined_aggregated_tax_plots)
```


```{r kombination aller vier tax plots}
library(cowplot)

fuel_prices_diesel <- fuel_prices_combined %>%
  filter(fuel_type == "Panel A: Diesel")

fuel_prices_gasoline <- fuel_prices_combined %>%
  filter(fuel_type == "Panel B: Gasoline")

# Erster Plot
plot_all_taxes_disaggregation_wv_1 <- ggplot(data = fuel_prices_diesel, aes(x = year)) +
  geom_line(aes(y = road_tax, colour = "Road Tax", linetype = "Road Tax")) +
  geom_line(aes(y = co2_tax, colour = "CO\u2082 Tax", linetype = "CO\u2082 Tax")) +
  geom_line(aes(y = vat, colour = "VAT", linetype = "VAT")) +
  geom_line(aes(y = basic_tax_diesel, colour = "Basic Tax", linetype = "Basic Tax")) +
  geom_line(aes(y = full_price, colour = "Retail Price", linetype = "Retail Price")) +
  geom_vline(xintercept = 1991, linetype = "dotted", colour = "black") +
  annotate("text", x = 1995, y = 13, vjust = -0.5, label = "Carbon Tax", color = "black", size = 3) +
  facet_wrap(~"Panel A.\nDiesel disaggregated", ncol = 1) +
  labs(title = NULL,
       x = NULL,  # Removes the x-axis label
       y = "Price (NOK/litre)",
       colour = NULL,
       linetype = NULL) +
  theme_classic() +
  theme(
    legend.position = "none",
    strip.text = element_text(size = 11.5, color = "black", hjust = 0), # Beispiele für Layout-Anpassungen
    strip.background = element_blank()
  ) +
  scale_colour_manual(values = c("Road Tax" = "black", "VAT" = "gray20", "CO\u2082 Tax" = "grey40", "Basic Tax" = "grey60", "Retail Price" = "grey80")) +
  scale_linetype_manual(values = c("Road Tax" = "solid", "VAT" = "dotdash", "CO\u2082 Tax" = "dashed","Basic Tax" = "dotted", "Retail Price" = "longdash")) +
  scale_y_continuous(limits = c(0, 15), breaks = seq(0, 14, by = 2), expand = expansion(mult = c(0, 0))) + # More frequent breaks on the y-axis
  scale_x_continuous(limits = c(1985, 2009), breaks = seq(1985, 2005, by = 5) , expand = expansion(mult = c(0, 0)))

# Zweiter Plot
plot_all_taxes_disaggregation_wv_2 <- ggplot(data = fuel_prices_gasoline, aes(x = year)) +
  geom_line(aes(y = road_tax, colour = "Road Tax", linetype = "Road Tax")) +
  geom_line(aes(y = co2_tax, colour = "CO\u2082 Tax", linetype = "CO\u2082 Tax")) +
  geom_line(aes(y = vat, colour = "VAT", linetype = "VAT")) +
  geom_line(aes(y = basic_tax_diesel, colour = "Basic Tax", linetype = "Basic Tax")) +
  geom_line(aes(y = full_price, colour = "Retail Price", linetype = "Retail Price")) +
  geom_vline(xintercept = 1991, linetype = "dotted", colour = "black") +
  annotate("text", x = 1995, y = 13, vjust = -0.5, label = "Carbon Tax", color = "black", size = 3) +
  facet_wrap(~"Panel B.\nGasoline disaggregated", ncol = 1) +
  labs(title = NULL,
       x = NULL,  # Removes the x-axis label
       y = "Price (NOK/litre)",
       colour = NULL,
       linetype = NULL) +
  theme_classic() +
  theme(legend.position = "right",
        legend.title = element_blank(),  # Remove the legend title for simplicity
        legend.text = element_text(size = 8),  # Set text size for legend
        legend.background = element_rect(fill = "white", colour = "black"),
        strip.text = element_text(size = 11.5, color = "black", hjust = 0), # Beispiele für Layout-Anpassungen
        strip.background = element_blank()) +
  scale_colour_manual(values = c("Retail Price" = "grey80", "Road Tax" = "black", "VAT" = "gray20", "CO\u2082 Tax" = "grey40", "Basic Tax" = "grey60"),
                      breaks = c("Retail Price", "Road Tax", "VAT", "CO\u2082 Tax", "Basic Tax")) +
  scale_linetype_manual(values = c("Retail Price" = "longdash", "Road Tax" = "twodash", "VAT" = "dotdash", "CO\u2082 Tax" = "dashed", "Basic Tax" = "dotted"),
                        breaks = c("Retail Price", "Road Tax", "VAT", "CO\u2082 Tax", "Basic Tax")) +
  scale_y_continuous(limits = c(0, 15), breaks = seq(0, 14, by = 2), expand = expansion(mult = c(0, 0))) + # More frequent breaks on the y-axis
  scale_x_continuous(limits = c(1985, 2009), breaks = seq(1985, 2005, by = 5) , expand = expansion(mult = c(0, 0)))




# Dritter Plot
plot_all_taxes_aggregation_wv_1 <- ggplot(data = fuel_prices_diesel, aes(x = year)) +
  geom_line(aes(y = total_taxes, colour = "Total Tax", linetype = "Total Tax")) +
  geom_line(aes(y = full_price, colour = "Retail Price", linetype = "Retail Price")) +
  geom_vline(xintercept = 1991, linetype = "dotted", colour = "black") +
  annotate("text", x = 1995, y = 13, vjust = -0.5, label = "Carbon Tax", color = "black", size = 3) +
  facet_wrap(~"Panel C.\nDiesel aggregated", ncol = 1) +
  labs(title = NULL,
       x = NULL,  # Removes the x-axis label
       y = "Price (NOK/litre)",
       colour = NULL,
       linetype = NULL) +
  theme_classic() +
  theme(
    legend.position = "none",
    strip.text = element_text(size = 11.5, color = "black", hjust = 0), # Beispiele für Layout-Anpassungen
    strip.background = element_blank()
  ) +
  scale_colour_manual(values = c("Total Tax" = "black", "Retail Price" = "grey80")) +
  scale_linetype_manual(values = c("Total Tax" = "solid", "Retail Price" = "longdash")) +
  scale_y_continuous(limits = c(0, 15), breaks = seq(0, 14, by = 2), expand = expansion(mult = c(0, 0))) + # More frequent breaks on the y-axis
  scale_x_continuous(limits = c(1985, 2009), breaks = seq(1985, 2005, by = 5) , expand = expansion(mult = c(0, 0)))


# Vierter Plot
plot_all_taxes_aggregation_wv_2 <- ggplot(data = fuel_prices_gasoline, aes(x = year)) +
  geom_line(aes(y = total_taxes, colour = "Total Tax", linetype = "Total Tax")) +
  geom_line(aes(y = full_price, colour = "Retail Price", linetype = "Retail Price")) +
  geom_vline(xintercept = 1991, linetype = "dotted", colour = "black") +
  annotate("text", x = 1995, y = 13, vjust = -0.5, label = "Carbon Tax", color = "black", size = 3) +
  facet_wrap(~"Panel D.\nGasoline aggregated", ncol = 1) +
  labs(title = NULL,
       x = NULL,  # Removes the x-axis label
       y = "Price (NOK/litre)",
       colour = NULL,
       linetype = NULL) +
  theme_classic() +
  theme(legend.position = "right",
        legend.title = element_blank(),  # Remove the legend title for simplicity
        legend.text = element_text(size = 8),  # Set text size for legend
        legend.background = element_rect(fill = "white", colour = "black"),
        strip.text = element_text(size = 11.5, color = "black", hjust = 0), # Beispiele für Layout-Anpassungen
        strip.background = element_blank()
        ) +
  scale_colour_manual(values = c("Total Tax" = "black", "Retail Price" = "grey80")) +
  scale_linetype_manual(values = c("Total Tax" = "solid", "Retail Price" = "longdash")) +
  scale_y_continuous(limits = c(0, 15), breaks = seq(0, 14, by = 2), expand = expansion(mult = c(0, 0))) + # More frequent breaks on the y-axis
  scale_x_continuous(limits = c(1985, 2009), breaks = seq(1985, 2005, by = 5) , expand = expansion(mult = c(0, 0))) +
  guides(fill = guide_legend(override.aes = list(size = 3)))

# Combine plots
combined_aggregated_tax_plots <- cowplot::plot_grid(plot_aggregation_wv_1, plot_aggregation_wv_2, ncol = 2) 


# Combine plots
combined_all_tax_plots <- cowplot::plot_grid(plot_all_taxes_disaggregation_wv_1, plot_all_taxes_disaggregation_wv_2, plot_all_taxes_aggregation_wv_1, plot_all_taxes_aggregation_wv_2,   ncol = 2, rel_widths = c(.7, 1,.7, 1)) 

# Show the combined plot
print(combined_all_tax_plots)

# Save the plot with specific dimensions
# ggsave("plots/combined_tax_plots.jpg", plot = combined_all_tax_plots, width = 7, height = 7, units = "in", dpi = 500)
ggsave("plots/combined_tax_plots.jpg", plot = combined_all_tax_plots, width = 7, height = 6, units = "in", dpi = 500)
```



```{r initial disaggregation fuel price, message=FALSE, warning=FALSE}
# Plot for both diesel and gasoline prices and components
plot <- ggplot(data = fuel_prices_combined, aes(x = year)) +
  geom_line(aes(y = road_tax, colour = "Road Tax", linetype = "Road Tax")) +
  geom_line(aes(y = co2_tax, colour = "CO2 Tax", linetype = "CO2 Tax")) +
  geom_line(aes(y = vat, colour = "VAT", linetype = "VAT")) +
  geom_line(aes(y = basic_tax_diesel, colour = "Basic Tax", linetype = "Basic Tax")) +
  geom_line(aes(y = full_price, colour = "Full Price", linetype = "Full Price")) +
  geom_vline(xintercept = 1991, linetype = "dotted", colour = "black") +
  facet_wrap(~fuel_type, scales = "fixed", ncol = 2) +  # Ensures the same y-axis scale across facets
  labs(title = NULL,
       x = NULL,  # Removes the x-axis label
       y = "Price (NOK/litre)",
       colour = NULL,
       linetype = NULL) +
  theme_classic() +
  theme(legend.position = "right",
        strip.text = element_text(size = 12, face = "plain"),  # Increase font size and make bold for facet titles
        plot.title = element_text(size = 16, hjust = 0.5, face = "plain")) +  # Main title settings
  scale_colour_manual(values = c("Road Tax" = "grey", "CO2 Tax" = "black", "VAT" = "black", "Basic Tax" = "grey", "Full Price" = "black")) +
  scale_linetype_manual(values = c("Road Tax" = "solid", "CO2 Tax" = "dashed", "VAT" = "dotdash","Basic Tax" = "solid", "Full Price" = "solid")) +
  ylim(0, 12.5) +
  scale_y_continuous(breaks = seq(0, 12.5, by = 2.5))  # More frequent breaks on the y-axis

# Print the plot
print(plot)

```

Andersson p.7

```{r wv graph diesel gasoline}

# Create a line plot using ggplot2 with custom legend labels
consumption_plot_wv <- ggplot(norway_consumption_long, aes(x = year, y = value_kg, linetype = category)) +
  geom_line() +
  geom_vline(xintercept = 1991, linetype = "dotted", color = "black") +
  labs(title = NULL,
       x = "",
       y = "Road sector fuel consumption per capita (kg of oil equivalent)") +  
  theme_classic() +
  theme(legend.position = c(.85, .13),
        legend.title = element_blank(),  # Remove the legend title for simplicity
        legend.text = element_text(size = 8),  # Set text size for legend
        legend.background = element_rect(fill = "white", colour = "black"), 
        legend.key = element_blank()) +
  scale_color_manual(values = c("Road sector diesel fuel consumption per capita (kt of oil equivalent)" = "black", 
                                "Road sector gasoline fuel consumption per capita (kt of oil equivalent)" = "black"),
                     labels = c("Diesel", "Gasoline")) +
  scale_linetype_manual(values = c("Road sector diesel fuel consumption per capita (kt of oil equivalent)" = "dashed", 
                                   "Road sector gasoline fuel consumption per capita (kt of oil equivalent)" = "solid"),
                        labels = c("Diesel", "Gasoline")) +
  annotate("text", x = 1988, y = 75, vjust = -0.5, label = "Carbon Tax", color = "black", size = 3) +
  scale_y_continuous(limits = c(0, 500), breaks = seq(0, 500, by = 100), expand = expansion(mult = c(0, 0))) + # More frequent breaks on the y-axis
  scale_x_continuous(limits = c(1960, 2005), breaks = seq(1960, 2000, by = 10) , expand = expansion(mult = c(0, 0))) +
  guides(linetype = guide_legend(title = "", theme = theme(legend.box = "vertical")))


# Print the plot to see the output
print(consumption_plot_wv)

# Export the plot as a PNG file with a white background
ggsave("plots/consumption.jpg", plot = consumption_plot_wv, width = 7, height = 6, units = "in", bg = "white")

```


```{r initial graph diesel gasoline}

# Create a line plot using ggplot2 with custom legend labels
consumption_plot_initial <- ggplot(norway_consumption_long, aes(x = year, y = value_kg, color = category, linetype = category)) +
  geom_line() +
  geom_vline(xintercept = 1991, linetype = "dotted", color = "black") +
  labs(title = NULL,
       x = "",
       y = "Road sector fuel consumption per capita (kg of oil equivalent)") +  
  theme_minimal() +
  scale_color_manual(values = c("Road sector diesel fuel consumption per capita (kt of oil equivalent)" = "black", 
                                "Road sector gasoline fuel consumption per capita (kt of oil equivalent)" = "black"),
                     labels = c("Diesel", "Gasoline")) +
  scale_linetype_manual(values = c("Road sector diesel fuel consumption per capita (kt of oil equivalent)" = "dashed", 
                                   "Road sector gasoline fuel consumption per capita (kt of oil equivalent)" = "solid"),
                        labels = c("Diesel", "Gasoline")) +
  guides(color = guide_legend(title = ""),
         linetype = guide_legend(title = "")) +
  annotate("text", x = 1991, y = 100, vjust = -0.5, label = "Carbon Tax", color = "black", angle = 90, size = 3)

# Print the plot to see the output
print(consumption_plot_initial)


```



### placebo tests
p. 15 
```{r wv placebo tests}
library(cowplot)
eighties_placebo_plot <- ggplot(eighties_placebo_path_data, aes(x = Year)) +
  geom_line(aes(y = X10, linetype = "Norway"), color = "black") +
  geom_line(aes(y = Synthetic, linetype = "Synthetic Norway"), color = "black") +
  geom_vline(xintercept = 1981, linetype = "dotted", color = "black") +
  theme_classic() +
  scale_linetype_manual(values = c("Norway" = "solid", "Synthetic Norway" = "dashed")) +
  annotate("text", x = 1971.5, y = .5, label = "Placebo tax", hjust = 0) +
  scale_y_continuous(limits = c(0, 3), breaks = seq(0, 3, by = .5), expand = expansion(mult = c(0, 0))) + # More frequent breaks on the y-axis
  scale_x_continuous(limits = c(1960, 1995), breaks = seq(1960, 1990, by = 5) , expand = expansion(mult = c(0, 0)))+
  facet_wrap(~ "Panel A.\n1981", ncol = 1) + 
      labs(title = NULL,
       x = NULL,
       y = "Metric tons per capita (CO\u2082 from transport)") +
  theme(
    legend.position = "none",
    strip.text = element_text(size = 13, color = "black", hjust = 0), # Beispiele für Layout-Anpassungen
    strip.background = element_blank()
  )

seventies_placebo_plot <- ggplot(seventies_placebo_path_data, aes(x = Year)) +
  geom_line(aes(y = X10, linetype = "Norway")) +
  geom_line(aes(y = Synthetic, linetype = "Synthetic Norway")) +
  geom_vline(xintercept = 1971, linetype = "dotted", color = "black") +
  theme_classic() +
  scale_linetype_manual(values = c("Norway" = "solid", "Synthetic Norway" = "dashed")) +
  annotate("text", x = 1961.5, y = .5, label = "Placebo tax", hjust = 0) +
  scale_y_continuous(limits = c(0, 3), breaks = seq(0, 3, by = .5), expand = expansion(mult = c(0, 0))) + # More frequent breaks on the y-axis
  scale_x_continuous(limits = c(1960, 1995), breaks = seq(1960, 1990, by = 5) , expand = expansion(mult = c(0, 0)))+
  theme(legend.position = c(.75, .13),
        legend.title = element_blank(),  # Remove the legend title for simplicity
        legend.text = element_text(size = 8),  # Set text size for legend
        legend.background = element_rect(fill = "white", colour = "black"),
        ) +
  facet_wrap(~ "Panel B.\n1971", ncol = 1) +
  labs(title = NULL,
       x = NULL,
       y = "Metric tons per capita (CO\u2082 from transport)",) +
  theme(
    strip.text = element_text(size = 13, color = "black", hjust = 0), # Beispiele für Layout-Anpassungen
    strip.background = element_blank()
  )

# Combine plots
 combined_placebo_plots <- cowplot::plot_grid(eighties_placebo_plot, seventies_placebo_plot, ncol = 2) 

# Show the combined plot
print(combined_placebo_plots)

# Export plot
ggsave("plots/combined_placebo_plots.jpg", plot = combined_placebo_plots, width = 12, height = 6, units = "in", bg = "white")
```

```{r initial eighties}
# Plotting the path plot data
eighties_placebo_plot <- ggplot(eighties_placebo_path_data, aes(x = Year)) +
  geom_line(aes(y = X10, color = "Actual Norway")) +
  geom_line(aes(y = Synthetic, color = "Synthetic Norway")) +
  geom_vline(xintercept = 1981, linetype = "dotted", color = "black") +
  labs(title = "Placebo Test for Norway in 1981",
       x = "Year",
       y = "Metric tons per capita (CO2 from transport)",
       color = "Legend") +
  theme_minimal() +
  theme(legend.position = "bottomright") +
  scale_color_manual(values = c("Norway" = "blue", "Synthetic Norway" = "red")) +
  annotate("text", x = 1974, y = 1.0, label = "Placebo tax", hjust = 0)

# Print the plot
print(eighties_placebo_plot)
```

```{r initial seventies}
# Plotting the path plot data
seventies_placebo_plot <- ggplot(seventies_placebo_path_data, aes(x = Year)) +
  geom_line(aes(y = X10, color = "Actual Norway")) +
  geom_line(aes(y = Synthetic, color = "Synthetic Norway")) +
  geom_vline(xintercept = 1971, linetype = "dotted", color = "black") +
  labs(title = "Placebo Test for Norway in 1971",
       x = "Year",
       y = "Metric tons per capita (CO2 from transport)",
       color = "Legend") +
  theme_minimal() +
  theme(legend.position = "bottomright") +
  scale_color_manual(values = c("Norway" = "blue", "Synthetic Norway" = "red")) +
  annotate("text", x = 1974, y = 1.0, label = "Placebo tax", hjust = 0)

# Print the plot
print(seventies_placebo_plot)
```

Robustness test leave one out, Andersson p. 17
Shows countries that got a weight above 0.001 in the original analysis.
Highlight the versions without Switzerland and Denmark? others grey, Norway black, Synthetic Norway (includes all) black dashed
```{r wv leave one out}
significant_leave_one_out_long_plot <- significant_leave_one_out_long
significant_leave_one_out_long_plot$Condition[significant_leave_one_out_long_plot$Condition == "excl_Denmark"] <- "Denmark excluded"
significant_leave_one_out_long_plot$Condition[significant_leave_one_out_long_plot$Condition == "excl_Switzerland"] <- "Switzerland excluded"
significant_leave_one_out_long_plot$Condition[significant_leave_one_out_long_plot$Condition == "Synthetic_Norway"] <- "Synthetic Norway"
significant_leave_one_out_long_plot$Condition[significant_leave_one_out_long_plot$Condition == "excl_Canada"] <- "Other country excluded"


leave_one_out_plot <- ggplot(significant_leave_one_out_long_plot, aes(x = Year, y = CO2_per_capita, color = Condition, linetype = Condition)) +
  geom_line() +
  geom_vline(xintercept = 1991, linetype = "dotted", color = "black") +
  annotate("text", x = 1987, y = .75, vjust = -0.5, label = "Carbon Tax", color = "black", size = 3) +
  labs(title = NULL,
       x = NULL,
       y = "CO\u2082 Emissions per Capita (metric tons)",
       color = "Condition") +
  theme_classic() +
  theme(legend.position = c(.85, .2),
        legend.title = element_blank(),  # Remove the legend title for simplicity
        legend.text = element_text(size = 8),  # Set text size for legend
        legend.background = element_rect(fill = "white", colour = "black")) + 
  scale_y_continuous(limits = c(0, 3), breaks = seq(0, 3, by = .5), expand = expansion(mult = c(0, 0))) + # More frequent breaks on the y-axis
  scale_x_continuous(expand = expansion(mult = c(0, 0)))+
  scale_linetype_manual(values = c(
                                    "Denmark excluded" = "longdash",
                                    "Switzerland excluded" = "twodash",
                                    "Other country excluded" = "solid",
                                    "excl_France"  = "solid",
                                    "excl_Greece"  = "solid",
                                    "excl_Japan"  = "solid",
                                    "excl_Portugal"  = "solid",
                                    "excl_Spain"  = "solid",
                                    "excl_United States" = "solid",
                                    "Norway" = "solid",
                                    "Synthetic Norway" = "dotted"),
                          breaks = c(
                                    "Norway", "Synthetic Norway", "Denmark excluded", "Switzerland excluded", "Other country excluded")) +
  scale_color_manual(values = c(
                                    "Denmark excluded" = "grey15",
                                    "Switzerland excluded" = "grey50",
                                    "Other country excluded" = "grey85",
                                    "excl_France" = "grey85",
                                    "excl_Greece" = "grey85",
                                    "excl_Japan" = "grey85",
                                    "excl_Portugal" = "grey85",
                                    "excl_Spain" = "grey85",
                                    "excl_United States" = "grey85",
                                    "Norway" = "black",
                                    "Synthetic Norway" = "black"),
                          breaks = c("Norway", "Synthetic Norway", "Denmark excluded", "Switzerland excluded", "Other country excluded")) 

 

# Print the plot
print(leave_one_out_plot)

# Save the plot with specific dimensions
ggsave("plots/leave_one_out_plot.jpg", plot = leave_one_out_plot, width = 7, height = 6, units = "in", dpi = 500)
```


Andersson p.19
```{r wv gdp_plot}
gdp_path_plot <- ggplot(gdp_path_data, aes(x = Year)) +
  geom_line(aes(y = X10, color = "Norway", linetype = "Norway"), size = 0.5) +  # Solid line for Norway (Actual data)
  geom_line(aes(y = Synthetic, color = "Synthetic Norway", linetype = "Synthetic Norway"), size = 0.5) +  # Dashed line for Synthetic control
  geom_vline(xintercept = 1991, linetype = "dotted", color = "black", size = 0.5) +  # Dotted line at the year 1990
  geom_rect(aes(xmin = 1987, xmax = 1992, ymin = -Inf, ymax = Inf), fill = "grey", alpha = 0.01) +  # Shaded area for the recession
  labs(title = NULL,
       x = NULL,
       y = "GDP per capita (PPP, 2015 USD)",
       color = "Legend",
       linetype = "Legend") +  # Label for linetype legend
  theme_classic() +
  theme(legend.position = c(0.85, 0.13),  # Position the legend at the bottom left
        legend.title = element_blank(),  # Remove the legend title for simplicity
        legend.text = element_text(size = 8),  # Set text size for legend
        legend.background = element_rect(fill = "white", colour = "black"),
        legend.key = element_blank()) +  # No boxes around the legend symbols
  annotate("text", x = 1986, y = max(gdp_path_data$Synthetic, na.rm = TRUE) * 0.27, label = "Carbon tax", hjust = 0, size = 3, color = "black") +
  scale_y_continuous(limits = c(0, 50000), breaks = seq(0, 50000, by = 5000), expand = expansion(mult = c(0, 0)),  labels = function(x) format(x, big.mark = ",", scientific = FALSE)) +
  scale_x_continuous(limits = c(1960, 2005), breaks = seq(1960, 2005, by = 10), expand = expansion(mult = c(0, 0))) +
  scale_color_manual(values = c("Norway" = "black", "Synthetic Norway" = "black")) +  # Set line colors
  scale_linetype_manual(values = c("Norway" = "solid", "Synthetic Norway" = "dashed"))  # Set line types


gdp_path_plot
# Save the plot
ggsave("plots/gdp_path_plot.jpg", plot = gdp_path_plot, width = 7, height = 6, units = "in", dpi = 500)
```


Andersson p.20
```{r wv initial gdp and co2 deviation from synthetic}
# dataframes: gdp_path_data and path_data
plot_gdp_path_data_percentage <- gdp_path_data %>%
    mutate(percentage_gdp = X10 / Synthetic) %>%
    mutate(percentage_gdp_deviation = percentage_gdp - 1 ) %>%
    rename(synthetic_gdp = Synthetic) %>%
    rename(real_gdp = X10)  
    
plot_co2_path_data_percentage <- path_data %>%
    mutate(percentage_CO2 = X10 / Synthetic ) %>%
    mutate(percentage_CO2_deviation = percentage_CO2 - 1 ) %>%
    rename(synthetic_CO2 = Synthetic) %>%
    rename(real_CO2 = X10) 

plot_co2_gdp_path_data_percentage <- merge(plot_co2_path_data_percentage, plot_gdp_path_data_percentage, by = "Year")

# Create combined plot
co2_gdp_combined_plot <- ggplot(plot_co2_gdp_path_data_percentage, aes(x = Year)) +
  geom_line(aes(y = percentage_gdp_deviation, color = "GDP Deviation")) +
  geom_line(aes(y = percentage_CO2_deviation, color = "CO2 Deviation")) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +  # Zero line
  geom_vline(xintercept = 1991, linetype = "dotted", color = "black", size = 0.5) +  # Dotted line at the year 1991
  geom_rect(aes(xmin = 1987, xmax = 1992, ymin = -Inf, ymax = Inf), fill = "grey", alpha = 0.01) +  # Shaded area for the recession
  annotate("text", x = 1986, y = -.13, label = "Carbon tax", hjust = 0, size = 3, color = "black") +
  labs(title = NULL,
       x = NULL,
       y = "Deviation of Norway from synthetic Norway") +
  theme_classic() +
  scale_y_continuous(labels = scales::percent, limits = c(-.25, .4), breaks = seq(-.2, .4, by = 0.1), expand = expansion(mult = c(0, 0))) +
  scale_x_continuous(limits = c(1960, 2006), breaks = seq(1960, 2005, by = 5), expand = expansion(mult = c(0, 0))) +
  scale_color_manual(values = c("GDP Deviation" = "grey", "CO2 Deviation" = "black"), labels = c("CO\u2082 Emissions from transport", "GDP")) +
  theme(legend.position = c(0.17, 0.1),  # Position the legend at the bottom left
        legend.title = element_blank(),  # Remove the legend title for simplicity
        legend.text = element_text(size = 8),  # Set text size for legend
        legend.background = element_rect(fill = "white", colour = "black"),
        legend.key = element_blank())

print (co2_gdp_combined_plot)

# Save  plot
ggsave("plots/co2_gdp_combined_plot.jpg", plot = co2_gdp_combined_plot, width = 7, height = 6, units = "in", dpi = 500)

```


p.16
```{r wv placebo in-space test gap plot}
in_space_gap_data_long_plot <- in_space_gap_data_long

in_space_gap_data_long_plot$country[in_space_gap_data_long_plot$country == "Australia"] <- "Other Countries"

placebo_in_space_test_gap_plot_1 <- ggplot(data = in_space_gap_data_long_plot, aes(x = year, y = gap, group = country, color = country, linetype = country)) +
  geom_line() +  # Use line geometry to connect data points over years
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  geom_vline(xintercept = 1991, linetype = "dotted", color = "black") +
  annotate("text", x = 1997, y = .7, vjust = -0.5, label = "Carbon Tax", color = "black", size = 3) +
  scale_color_manual(values = c(
    "Norway" = "black",
    "Poland" = "grey20",
    "United States" = "grey40",
    "Other Countries" = "grey80",
    "Belgium" = "grey80",
    "Canada" = "grey80",      
    "Denmark" = "grey80",       
    "France" = "grey80",        
    "Greece" = "grey80",        
    "Iceland" = "grey80",       
    "Japan" = "grey80",         
    "New Zealand" = "grey80",   
    "Portugal" = "grey80",      
    "Spain" = "grey80",
    "Switzerland"= "grey80"),
    breaks = c(
      "Norway", "United States", "Poland", "Other Countries")) +
  scale_linetype_manual(values = c(
    "Norway" = "solid",
    "Poland" = "longdash",
    "United States" = "twodash",
    "Other Countries" = "solid",
    "Belgium" = "solid",
    "Canada" = "solid",      
    "Denmark" = "solid",       
    "France" = "solid",        
    "Greece" = "solid",        
    "Iceland" = "solid",       
    "Japan" = "solid",         
    "New Zealand" = "solid",   
    "Portugal" = "solid",      
    "Spain" = "solid",
    "Switzerland"= "solid"),
    breaks = c(
      "Norway", "United States", "Poland", "Other Countries")) +
  labs(title = NULL,
       x = NULL,
       y = "Gap in metric tons per capita \n(CO\u2082 from transport)") +
  facet_wrap(~"Panel A", ncol = 1) +
  theme_classic() +  # Use a minimal theme for a clean look
  theme(legend.position = c(.25, .18),
        legend.title = element_blank(),  # Remove the legend title for simplicity
        legend.text = element_text(size = 8),  # Set text size for legend
        legend.background = element_rect(fill = "white", colour = "black"),
        strip.text = element_text(size = 13, color = "black", hjust = 0), # Beispiele für Layout-Anpassungen
        strip.background = element_blank()) + 
  scale_y_continuous(limits = c(-1.5, 1.5), breaks = seq(-1.5, 1.5, by = .5), expand = expansion(mult = c(0, 0))) + # More frequent breaks on the y-axis
  scale_x_continuous(expand = expansion(mult = c(0, 0)))

print(placebo_in_space_test_gap_plot_1)
```  



```{r initial placebo in-space test gap plot}
ggplot(data = in_space_gap_data_long, aes(x = year, y = gap, group = country, color = country)) +
  geom_line() +  # Use line geometry to connect data points over years
  scale_color_manual(values = c("Norway" = "black", "Other" = rep("grey", length(unique(in_space_gap_data_mspe_20_long$Country)) - 1))) +
  labs(title = "Gap in CO2 Emissions Over Years by Country",
       x = "Year",
       y = "Gap in CO2 Emissions",
       color = "Country") +
  theme_minimal() +  # Use a minimal theme for a clean look
  theme(legend.position = "none")  # Optionally hide the legend if not needed
```

```{r wv placebo in-space test, excluding MSPE> 20*Norway, gap plot}
in_space_gap_data_mspe_20_long_plot <- in_space_gap_data_mspe_20_long
in_space_gap_data_mspe_20_long_plot$Country[in_space_gap_data_mspe_20_long_plot$Country == "Australia"] <- "Other Countries"

placebo_in_space_test_gap_plot_2 <- ggplot(data = in_space_gap_data_mspe_20_long_plot, aes(x = Year, y = Gap, group = Country, color = Country)) +
  geom_line() +  # Use line geometry to connect data points over years
  geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
  geom_vline(xintercept = 1991, linetype = "dotted", color = "black") +
  annotate("text", x = 1997, y = .7, vjust = -0.5, label = "Carbon Tax", color = "black", size = 3) +
  scale_color_manual(values = c(
    "Norway" = "black",
    "Other Countries" = "grey80",
    "Belgium" = "grey80",
    "Canada" = "grey80",      
    "Denmark" = "grey80",       
    "France" = "grey80",        
    "Greece" = "grey80",        
    "Iceland" = "grey80",       
    "Japan" = "grey80",         
    "New Zealand" = "grey80",   
    "Portugal" = "grey80",      
    "Spain" = "grey80",
    "Switzerland"= "grey80"),
    breaks = c(
      "Norway", "Other Countries")) +
  scale_linetype_manual(values = c(
    "Norway" = "solid",
    "Other Countries" = "solid",
    "Belgium" = "solid",
    "Canada" = "solid",      
    "Denmark" = "solid",       
    "France" = "solid",        
    "Greece" = "solid",        
    "Iceland" = "solid",       
    "Japan" = "solid",         
    "New Zealand" = "solid",   
    "Portugal" = "solid",      
    "Spain" = "solid",
    "Switzerland"= "solid"),
    breaks = c(
      "Norway", "Other Countries")) +
  labs(title = NULL,
       x = NULL,
       y = "Gap in metric tons per capita \n(CO\u2082 from transport)",
       color = "Country") +
  facet_wrap(~"Panel B", ncol = 1) +
  theme_classic() +  # Use a minimal theme for a clean look
  theme(legend.position = "none",
        strip.text = element_text(size = 13, color = "black", hjust = 0), # Beispiele für Layout-Anpassungen
        strip.background = element_blank()) + 
  scale_y_continuous(limits = c(-1.5, 1.5), breaks = seq(-1.5, 1.5, by = .5), expand = expansion(mult = c(0, 0))) + # More frequent breaks on the y-axis
  scale_x_continuous(expand = expansion(mult = c(0, 0))) 
```


```{r wv combined plot placebo in-space test, excluding MSPE> 20*Norway, gap plot}
# Combine plots
placebo_in_space_test_gap_plot_combined <- cowplot::plot_grid(placebo_in_space_test_gap_plot_1, placebo_in_space_test_gap_plot_2, ncol = 2) 

# Show the combined plot
print(placebo_in_space_test_gap_plot_combined)

# Save the plot with specific dimensions
ggsave("plots/placebo_in_space_test_gap_plot.jpg", plot = placebo_in_space_test_gap_plot_combined, width = 12, height = 6, units = "in", dpi = 500)
```


p.17
```{r wv}
# Create a horizontal bar plot with ggplot2
MSPE_ratio_plot <- ggplot(ratio_df, aes(x = reorder(Country, MSPE_Ratio), y = MSPE_Ratio, fill = Country)) +
  geom_bar(stat = "identity", width = 0.5) +
  coord_flip() +  # Make the bar plot horizontal
  scale_fill_manual(values = c(
    "Norway" = "black",
    "Australia" = "grey80",
    "Belgium" = "grey80",
    "Canada" = "grey80",      
    "Denmark" = "grey80",       
    "France" = "grey80",        
    "Greece" = "grey80",        
    "Iceland" = "grey80",       
    "Japan" = "grey80",         
    "New Zealand" = "grey80",   
    "Poland" = "grey80",
    "Portugal" = "grey80",      
    "Spain" = "grey80",
    "Switzerland"= "grey80",
    "United States" = "grey80")) +
  labs(title = NULL,
       x = NULL,
       y = "Post-period MSPE/Pre-period MSPE") +
  theme_classic() +
  theme(
      legend.position = "none"
  ) +
#  scale_x_discrete(expand = expansion(mult = c(0, 0))) + # More frequent breaks on the y-axis
  scale_y_continuous(breaks = seq(0, 10, by = 2), expand = expansion(mult = c(0, 0)))

print(MSPE_ratio_plot)

# Save the plot with specific dimensions
ggsave("plots/MSPE_ratio_plot.jpg", plot = MSPE_ratio_plot, width = 7, height = 6, units = "in", dpi = 500)

```


Panel B like p. 17 leave one out 
```{r wv leave one out with full sample}
all_significant_leave_one_out_long_plot <- all_significant_leave_one_out_long
all_significant_leave_one_out_long_plot$Condition[all_significant_leave_one_out_long_plot$Condition == "excl_Luxembourg"] <- "Luxembourg excluded"
all_significant_leave_one_out_long_plot$Condition[all_significant_leave_one_out_long_plot$Condition == "excl_Australia"] <- "Other Country excluded"
all_significant_leave_one_out_long_plot$Condition[all_significant_leave_one_out_long_plot$Condition == "Synthetic_Norway"] <- "Synthetic Norway"


all_leave_one_out_plot <- ggplot(all_significant_leave_one_out_long_plot, aes(x = Year, y = CO2_per_capita, color = Condition, linetype = Condition)) +
  geom_line() +
  geom_vline(xintercept = 1991, linetype = "dotted", color = "black") +
  annotate("text", x = 1984, y = 1.5, vjust = 0.5, label = "Carbon Tax", color = "black") +
  labs(title = NULL,
       x = NULL,
       y = "Metric tons per capita \n(CO\u2082 from transport)",
       color = "Condition") +
  theme_classic() +
  scale_color_manual(values = c(
    "excl_Austria" = "grey80",
    "excl_Belgium" = "grey80",
    "excl_Canada" = "grey80",
    "excl_Denmark" = "grey80",
    "excl_Finland" = "grey80",
    "excl_France" = "grey80",
    "excl_Germany" = "grey80",
    "excl_Greece" = "grey80",
    "excl_Iceland" = "grey80",
    "excl_Ireland" = "grey80",
    "excl_Italy" = "grey80",
    "excl_Japan" = "grey80",
    "excl_Netherlands" = "grey80",
    "excl_New Zealand" = "grey80",
    "excl_Poland" = "grey80",
    "excl_Portugal" = "grey80",
    "excl_Spain" = "grey80",
    "excl_Sweden" = "grey80",
    "excl_Switzerland" = "grey80",
    "excl_Turkey" = "grey80",
    "excl_United Kingdom" = "grey80",
    "excl_United States" = "grey80",
    "Norway" = "black",
    "Synthetic Norway" = "black",
    "Luxembourg excluded" = "grey20",
    "Other Country excluded" = "grey80"
  ),
    breaks = c(
      "Norway", "Synthetic Norway", "Luxembourg excluded", "Other Country excluded")) +
  scale_linetype_manual(values = c(
    "excl_Austria" = "solid",
    "excl_Belgium" = "solid",
    "excl_Canada" = "solid",
    "excl_Denmark" = "solid",
    "excl_Finland" = "solid",
    "excl_France" = "solid",
    "excl_Germany" = "solid",
    "excl_Greece" = "solid",
    "excl_Iceland" = "solid",
    "excl_Ireland" = "solid",
    "excl_Italy" = "solid",
    "excl_Japan" = "solid",
    "excl_Netherlands" = "solid",
    "excl_New Zealand" = "solid",
    "excl_Poland" = "solid",
    "excl_Portugal" = "solid",
    "excl_Spain" = "solid",
    "excl_Sweden" = "solid",
    "excl_Switzerland" = "solid",
    "excl_Turkey" = "solid",
    "excl_United Kingdom" = "solid",
    "excl_United States" = "solid",
    "Norway" = "solid",
    "Synthetic Norway" = "dashed",
    "Luxembourg excluded" = "dotted",
    "Other Country excluded" = "solid"
    ),
    breaks = c(
      "Norway", "Synthetic Norway", "Luxembourg excluded", "Other Country excluded")) +
  facet_wrap(~"Panel B. \nFull Sample Leave-One-Out", ncol = 1) +
  theme(legend.position = c(.36, .18),
        legend.title = element_blank(),  # Remove the legend title for simplicity
        legend.text = element_text(size = 7),  # Set text size for legend
        legend.background = element_rect(fill = "white", colour = "black"),
        strip.text = element_text(size = 13, color = "black", hjust = 0), # Beispiele für Layout-Anpassungen
        strip.background = element_blank()
        ) + 
  scale_y_continuous(limits = c(0, 3.5), breaks = seq(0, 3.5, by = .5), expand = expansion(mult = c(0, 0))) + # More frequent breaks on the y-axis
  scale_x_continuous(expand = expansion(mult = c(0, 0)))

# Print the plot
print(all_leave_one_out_plot)

```


Panel A like p. 18 Panel A
```{r wv full sample path.plot}
temporary_path_data <- path_data %>%
  rename(Synthetic_import = Synthetic)


full_path_data_plot <- merge(full_path_data, temporary_path_data[, c("Year", "Synthetic_import")], by = "Year", all.x = TRUE)

full_sample_path_plot <- ggplot(full_path_data_plot, aes(x = Year)) +
  geom_line(aes(y = X17, color = "Norway", linetype = "Norway"), size = 0.5) +  # Solid line for Norway (Actual data)
  geom_line(aes(y = Synthetic, color = "Synthetic Norway (full sample)", linetype = "Synthetic Norway (full sample)"), size = 0.5) +  # Dashed line for Synthetic control
  geom_line(aes(y = Synthetic_import, color = "Synthetic Norway", linetype = "Synthetic Norway"), size = 0.5) +  # Solid line for Norway (Actual data)
  geom_vline(xintercept = 1991, linetype = "dotted", color = "black", size = 0.5) +  # Dotted line at the year 1990
  labs(title = NULL,
       x = NULL,
       y = "Metric tons per capita \n(CO\u2082 from transport)",
       color = "Legend",
       linetype = "Legend") +  # Label for linetype legend
  facet_wrap(~"Panel A. \nFull Sample", ncol = 1) +
  theme_classic() +
  theme(legend.position = c(.33, .16),
        legend.title = element_blank(),  # Remove the legend title for simplicity
        legend.text = element_text(size = 7),  # Set text size for legend
        legend.background = element_rect(fill = "white", colour = "black"),
        strip.text = element_text(size = 13, color = "black", hjust = 0), # Beispiele für Layout-Anpassungen
        strip.background = element_blank()) + 
  annotate("text", x = 1978, y = 1.5, label = "Carbon tax", hjust = 0, color = "black") +
  scale_y_continuous(limits = c(0, 3.5), breaks = seq(0, 3.5, by = 0.5), expand = expansion(mult = c(0, 0))) +
  scale_x_continuous(limits = c(1960, 2005), breaks = seq(0, 2005, by = 10) , expand = expansion(mult = c(0, 0))) +
  scale_color_manual(values = c("Norway" = "black", "Synthetic Norway (full sample)" = "black", "Synthetic Norway" = "black")) +  # Set line colors
  scale_linetype_manual(values = c("Norway" = "solid", "Synthetic Norway (full sample)" = "dotted", "Synthetic Norway" = "dashed"))  # Set line types

print(full_sample_path_plot)

# Save the plot 
# ggsave("plots/path_plot.jpg", plot = path_plot, width = 7, height = 6, units = "in", dpi = 300)

```


```{r wv combined plot full sample path leave one out with full sample}
# Combine plots
luxembourg_comparison_plot_combined <- cowplot::plot_grid(full_sample_path_plot, all_leave_one_out_plot, ncol = 2) 

# Show the combined plot
print(luxembourg_comparison_plot_combined)

# Save the plot with specific dimensions
 ggsave("plots/luxembourg_comparison_plot_combined.jpg", plot = luxembourg_comparison_plot_combined, width = 12, height = 6, units = "in", dpi = 500)
```